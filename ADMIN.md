# 管理画面

Rasp-Cast には Web ベースの管理画面があり、プレイリストの管理をブラウザから行うことができます。

## 管理画面へのアクセス

管理画面は `?admin` パラメータ付きの URL でアクセスします：

```
http://localhost:3000/?admin
```

または外部公開している場合：

```
http://your-server:8000/?admin
```

## 認証

管理画面は API_KEY による認証が必要です。

### API_KEY の設定

`.env` ファイルまたは環境変数で API_KEY を設定してください：

```bash
API_KEY=your-secret-key-here
```

**注意**: API_KEY が未設定の場合、すべての管理操作が認証なしで実行可能になります。本番環境では必ず設定してください。

### ログイン

1. 管理画面にアクセスするとログインフォームが表示されます
2. 設定した API_KEY を入力
3. 「ログイン」ボタンをクリック

API_KEY は localStorage に保存されるため、次回アクセス時は自動的にログインされます。

## 機能

### プレイリスト一覧

現在のプレイリストに登録されているすべてのトラックが表示されます：

- 📁 ローカルファイルトラック
- 🌐 URL トラック

各トラックには以下の情報が表示されます：

- タイトル
- アーティスト
- ファイルパスまたは URL

### トラック追加

#### ローカルファイルを追加

1. 「ローカルファイル」タブを選択
2. 以下の情報を入力：
   - **タイトル**: 曲名（必須）
   - **アーティスト**: アーティスト名（必須）
   - **ファイルパス**: `music/` ディレクトリからの相対パス（必須）
3. 「追加」ボタンをクリック

例：
```
タイトル: Summer Breeze
アーティスト: Cool Jazz Ensemble
ファイルパス: jazz/summer_breeze.mp3
```

実際のファイルは `music/jazz/summer_breeze.mp3` に配置する必要があります。

#### URL トラックを追加

1. 「URL」タブを選択
2. 以下の情報を入力：
   - **タイトル**: 曲名（必須）
   - **アーティスト**: アーティスト名（必須）
   - **URL**: MP3 ファイルの直接 URL（必須）
3. 「追加」ボタンをクリック

例：
```
タイトル: Podcast Episode 42
アーティスト: Tech Talk
URL: https://example.com/media/episode42.mp3
```

**注意**: URL トラックは再生時にダウンロードされます。取得に時間がかかる場合があります（タイムアウト: 10秒）。

### トラック削除

各トラックの右側にあるゴミ箱アイコン（🗑️）をクリックすると、確認ダイアログが表示され、削除できます。

削除したトラックは即座にプレイリストから削除され、`playlist.json` に反映されます。

## ナビゲーション

### 公開ダッシュボードへ戻る

管理画面右上の「ダッシュボード」ボタンをクリックすると、公開ダッシュボード（`/`）に移動します。

### ログアウト

管理画面右上の「ログアウト」ボタンをクリックすると、localStorage から API_KEY が削除され、ログイン画面に戻ります。

## セキュリティ

### API_KEY の管理

- API_KEY は秘密情報として扱ってください
- 推測されにくい十分な長さのランダムな文字列を使用してください
- API_KEY を公開リポジトリにコミットしないでください（`.env` は `.gitignore` に含まれています）

### HTTPS の使用

外部公開する場合は、必ず HTTPS を使用してください。HTTP 経由では API_KEY が平文で送信されるため、盗聴のリスクがあります。

推奨構成: WireGuard VPN + nginx リバースプロキシ（[INSTALL.md](INSTALL.md) 参照）

## トラブルシューティング

### ログインできない

**症状**: API_KEY を入力しても「認証に失敗しました」と表示される

**原因と対処**:

1. API_KEY が正しいか確認
   ```bash
   # サーバー側で確認
   cat .env | grep API_KEY
   ```

2. サーバーが最新版か確認（v0.2.6 以降が必要）
   ```bash
   git pull
   npm run build
   npm run build:frontend
   sudo systemctl restart rasp-cast
   ```

3. ブラウザのコンソールでエラーを確認
   - F12 でデベロッパーツールを開く
   - Console タブでエラーメッセージを確認
   - Network タブで `/playlist` リクエストのステータスコードを確認（401 なら API_KEY が間違っている）

### プレイリストが表示されない

**症状**: ログイン後、「プレイリストの取得に失敗しました」と表示される

**原因と対処**:

1. API_KEY の権限を確認（上記と同じ）

2. `playlist.json` が存在するか確認
   ```bash
   ls -l playlist.json
   ```

3. サーバーログを確認
   ```bash
   journalctl -u rasp-cast -n 50
   ```

### トラックが追加できない

**症状**: 「追加」ボタンをクリックしても追加されない

**原因と対処**:

1. すべての必須フィールドが入力されているか確認

2. ローカルファイルの場合、ファイルが実際に存在するか確認
   ```bash
   ls -l music/your-track.mp3
   ```

3. ブラウザのコンソールでエラーを確認

## 関連ドキュメント

- **[API.md](API.md)** - REST API リファレンス（プレイリスト管理 API の詳細）
- **[SERVICE.md](SERVICE.md)** - サービス管理・ログ確認
- **[INSTALL.md](INSTALL.md)** - デプロイ・外部公開の手順
